<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments :: head('Dashboard')}"></head>
<body>
<div th:replace="~{fragments :: nav}"></div>

<div class="container py-4">

  <!-- existing dashboard content (unchanged) ... -->

  <!-- Performance Charts -->
  <div sec:authorize="hasRole('ADMIN')" class="mb-5">
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card-3d p-4">
          <div class="fw-bold mb-3 text-uppercase small border-bottom pb-2">Order Status</div>
          <canvas id="orderStatusPie" height="250"></canvas>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card-3d p-4">
          <div class="fw-bold mb-3 text-uppercase small border-bottom pb-2">Monthly Statistics</div>
          <canvas id="salesLine" height="250"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- optionally: add a brand bar or stock donut canvas elements where desired -->
  <!-- <canvas id="brandBar" height="180"></canvas> -->
  <!-- <canvas id="stockDonut" height="180"></canvas> -->

  <!-- other content -->
</div>

<!-- Inline data for charts (Thymeleaf inlined JavaScript) -->
<script th:inline="javascript">
/*<![CDATA[*/
  const dashboardData = {
    orderStatusLabels: /*[[${orderStatusLabels}]]*/ [],
    orderStatusValues: /*[[${orderStatusValues}]]*/ [],
    monthsLabels: /*[[${monthsLabels}]]*/ [],
    monthsValues: /*[[${monthsValues}]]*/ [],
    brandLabels: /*[[${brandLabels}]]*/ [],
    brandValues: /*[[${brandValues}]]*/ [],
    // donut values are provided by the controller as a list; adapt here:
    stockDonut: (function(vals){
      var v = vals || [];
      return { red: v[0]||0, orange: v[1]||0, green: v[2]||0 };
    })(/*[[${donutValues}]]*/ [])
  };

  document.addEventListener('DOMContentLoaded', function(){
    if (window.renderDashboardCharts) {
      window.renderDashboardCharts(dashboardData);
    } else {
      console.warn('Dashboard charts renderer not loaded yet.');
    }
  });
/*]]>*/
</script>

</body>
</html>