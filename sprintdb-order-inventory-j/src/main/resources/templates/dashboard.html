<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head('Dashboard')}"></head>
<style>
    :root {
        /* Default Dark Theme Variables */
        --bg: #0d1117;
        --card-bg: #161b22;
        --text: #e6edf3;
        --border: #30363d;
        --shadow-3d: #000000;
        --btn-3d-shadow: #196127;
        --accent-gradient: linear-gradient(135deg, #7ee787, #79c0ff, #d2a8ff);
    }

    [data-theme="light"] {
        --bg: #f6f8fa;
        --card-bg: #ffffff;
        --text: #1f2328;
        --border: #d0d7de;
        --shadow-3d: #afb8c1;
        --btn-3d-shadow: #146c2e;
        --accent-gradient: linear-gradient(135deg, #1f883d, #0969da, #8250df);
    }

    body { 
        background-color: var(--bg); 
        color: var(--text); 
        transition: all 0.3s ease; 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* 3D Title Section */
    .section-title-3d {
        font-weight: 800;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.5px;
    }

    /* GitHub 3D Card */
    .card-3d {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 8px 0 var(--shadow-3d), 0 15px 20px rgba(0,0,0,0.2);
        transition: transform 0.2s;
        margin-bottom: 2rem;
    }

    /* 3D Action Tiles */
    .stat-tile-3d {
        background: var(--card-bg);
        border: 1px solid var(--border);
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 5px 0 var(--shadow-3d);
        transition: all 0.1s;
        text-decoration: none !important;
        display: block;
    }

    .stat-tile-3d:active {
        transform: translateY(3px);
        box-shadow: 0 2px 0 var(--shadow-3d);
    }

    /* 3D Button */
    .btn-3d-push {
        background: #238636;
        color: white !important;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-weight: 600;
        box-shadow: 0 4px 0 var(--btn-3d-shadow);
        transition: all 0.1s;
    }

    .btn-3d-push:active {
        transform: translateY(3px);
        box-shadow: 0 1px 0 var(--btn-3d-shadow);
    }

    /* Theme Switcher Button */
    .theme-toggle {
        background: var(--card-bg);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 20px;
        padding: 5px 15px;
        cursor: pointer;
        box-shadow: 0 3px 0 var(--border);
    }

    .theme-toggle:active { transform: translateY(2px); box-shadow: 0 1px 0 var(--border); }

    .table { color: var(--text); border-color: var(--border); }
    .badge-gh { border: 1px solid var(--border); background: var(--bg); color: var(--text); }
</style>
<body data-theme="dark">

<div th:replace="~{fragments :: nav}"></div>

<div class="container py-4">

  <!-- Header with Theme Switcher -->
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h1 class="h3 section-title-3d mb-0">CONTROL PANEL</h1>
      <span class="badge badge-gh mt-1" th:text="${loginRole}">Admin</span>
    </div>
    
    <div class="d-flex gap-3">
      <button class="theme-toggle" onclick="toggleTheme()">
        <i id="theme-icon" class="bi bi-moon-stars-fill"></i> Switch Theme
      </button>

      <div class="dropdown">
        <button class="btn btn-outline-secondary rounded-3 position-relative" id="notifBell" data-bs-toggle="dropdown">
          <i class="bi bi-bell"></i>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" th:text="${lowStockCount}">0</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow border-0 card-3d p-2" style="min-width: 300px; background: var(--card-bg);">
          <li class="dropdown-header text-uppercase small fw-bold" style="color: var(--text)">Inventory Alerts</li>
          <li th:each="a : ${lowStockAlerts}">
            <div class="px-3 py-2 small border-bottom border-secondary">
              <div class="fw-bold" th:text="${a.brand + ' ' + a.name}">Item</div>
              <div class="text-danger">Critical Stock: <span th:text="${a.availableQty}">0</span></div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  

  <!-- 3D Action Tiles Grid -->
  <div class="row g-4 mb-5">
    <div class="col-md-3">
      <a th:href="@{/orders}" class="stat-tile-3d">
        <div class="h3 mb-2" style="color: #79c0ff;"><i class="bi bi-clipboard-data"></i></div>
        <div class="fw-bold text-uppercase small" style="color: var(--text)">Orders</div>
        <div class="text-muted small">Check Status</div>
      </a>
    </div>
    <div class="col-md-3" sec:authorize="hasRole('STAFF')">
      <a th:href="@{/staff/restock/new}" class="stat-tile-3d">
        <div class="h3 mb-2" style="color: #7ee787;"><i class="bi bi-box-seam"></i></div>
        <div class="fw-bold text-uppercase small" style="color: var(--text)">Restock</div>
        <div class="text-muted small">New Request</div>
      </a>
    </div>
  </div>

  <!-- Performance Charts -->
  <div sec:authorize="hasRole('ADMIN')" class="mb-5">
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card-3d p-4">
          <div class="fw-bold mb-3 text-uppercase small border-bottom pb-2">Order Status</div>
          <canvas id="orderStatusPie" height="250"></canvas>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card-3d p-4">
          <div class="fw-bold mb-3 text-uppercase small border-bottom pb-2">Monthly Statistics</div>
          <canvas id="salesLine" height="250"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Table in 3D Card -->
  <div sec:authorize="hasRole('STAFF')" class="card-3d p-0 overflow-hidden">
    <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
        <h2 class="h6 fw-bold text-uppercase mb-0">Recent Requests</h2>
        <button class="btn-3d-push py-1 px-3 small">View All</button>
    </div>
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead style="background: rgba(0,0,0,0.1)">
          <tr>
            <th>ID</th>
            <th>Product / Service</th>
            <th>Vendor</th>
            <th>Qty.</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="r : ${myRestocks}">
            <td class="fw-bold" th:text="${r.id}">1</td>
            <td th:text="${r.product.brand + ' ' + r.product.name}">Product</td>
            <td class="small" th:text="${r.vendor.name}">Vendor</td>
            <td th:text="${r.requestedQty}">10</td>
            <td>
              <span class="badge rounded-pill px-3" 
                    th:classappend="${r.status.name()=='PENDING' ? 'bg-warning text-dark' : 'bg-success'}"
                    th:text="${r.status}">PENDING</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function toggleTheme() {
    const body = document.body;
    const icon = document.getElementById('theme-icon');
    const currentTheme = body.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
      body.setAttribute('data-theme', 'light');
      icon.className = 'bi bi-sun-fill';
    } else {
      body.setAttribute('data-theme', 'dark');
      icon.className = 'bi bi-moon-stars-fill';
    }
  }
</script>
<script src="https://cdn.jsdelivr.net"></script>
<script src="https://cdn.jsdelivr.net"></script>
</body>
</html>
