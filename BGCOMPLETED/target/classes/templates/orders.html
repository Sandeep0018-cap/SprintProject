<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head('Orders')}"></head>
<body>
<div th:replace="~{fragments :: nav}"></div>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 section-title m-0">
      <i class="bi bi-box-arrow-in-right me-2"></i>Orders
    </h1>

    <form th:action="@{/orders}" method="get" class="d-inline">
  <label for="statusFilter" class="text-muted small mb-0">Filter:</label>

  <select id="statusFilter"
          class="form-select form-select-sm"
          name="status"
          onchange="handleStatusChange(this)">
    <!-- ALL (empty value) -->
 
    <!-- Other statuses -->
    <option th:each="s : ${statuses}"
            th:value="${s}"
            th:text="${s}"
            th:selected="${s == selectedStatus}">
    </option>
  </select>
</form>

<script>
  function handleStatusChange(selectEl) {
    const val = selectEl.value;
    // Resolve the action from the form (works with Thymeleaf th:action)
    const form = selectEl.form;
    const action = form.getAttribute('action') || '/orders';

    if (val === '') {
      // Go to /orders with no querystring
      window.location.href = action;
    } else {
      // Submit as /orders?status=VALUE
      form.submit();
    }
  }
</script>
    </form>
  </div>
</div>

  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr><th>#</th><th>Reference</th><th>Status</th><th>Created</th></tr>
        </thead>
        <tbody>
          <tr th:each="o : ${orders}">
            <td th:text="${o.id}">1</td>
            <td class="fw-semibold" th:text="${o.reference}">ORD-2026-0001</td>
            <td>
              <span class="badge"
                    th:classappend="${o.status.name()=='PENDING' ? ' bg-warning' :
                                    (o.status.name()=='INTRANSIT' ? ' bg-primary' :
                                     (o.status.name()=='DELIVERED' ? ' bg-success' : ' bg-danger'))}"
                    th:text="${o.status}">PENDING</span>
            </td>
            <td th:text="${#temporals.format(o.createdAt, 'dd MMM yyyy HH:mm')}">Date</td>
          </tr>
          <tr th:if="${#lists.isEmpty(orders)}">
            <td colspan="4" class="text-center text-muted py-3">No orders found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</body>
</html>