<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head('Restock Request')}"></head>

<body class="main-wrapper">

<div th:replace="~{fragments :: nav}"></div>

<div class="container py-4" style="max-width: 900px;">

    <h1 class="h3 section-title mb-4">
        <i class="bi bi-truck me-2 text-primary"></i> Procurement: Restock Request
    </h1>

    <div class="card border-0 shadow-soft">
        <div class="card-body p-4">

            <!-- ========================= EDIT MODE ========================= -->
            <div th:if="${isEdit}">
                <form th:action="@{/staff/restock/update/{id}(id=${req.id})}" th:object="${req}" method="post" class="row g-4">

                    <input type="hidden" th:field="*{id}" />
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Designated Vendor</label>
                        <select class="form-select shadow-inner" th:field="*{vendorId}" required>
                            <option value="" disabled>-- Select Vendor --</option>
                            <option th:each="v : ${vendors}"
                                    th:value="${v.vendorId ?: v.id}"
                                    th:text="${v.name}">
                            </option>
                        </select>
                        <div class="invalid-feedback d-block small"
                             th:if="${#fields.hasErrors('vendorId')}"
                             th:errors="*{vendorId}">Error</div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">Inventory Item</label>
                        <select class="form-select shadow-inner"
                                th:field="*{productId}"
                                th:disabled="${#lists.isEmpty(products)}"
                                required>
                            <option value="" disabled>-- Select Product --</option>
                            <option th:each="p : ${products}"
                                    th:value="${p.productId ?: p.id}"
                                    th:text="${p.brand + ' ' + p.name}">
                            </option>
                        </select>
                        <div class="invalid-feedback d-block small"
                             th:if="${#fields.hasErrors('productId')}"
                             th:errors="*{productId}">Error</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Required Quantity</label>
                        <input class="form-control shadow-inner"
                               type="number" min="1"
                               th:field="*{requestedQty}"
                               required />
                    </div>

                    <div class="col-12 d-flex gap-2 pt-2 align-items-center">

                        <button class="btn btn-primary px-4 shadow-soft" type="submit">
                            <i class="bi bi-cloud-arrow-up me-2"></i> Update Request
                        </button>

                        <a th:href="@{/dashboard}" class="btn btn-outline-secondary">Cancel</a>

                        <div class="ms-auto">
                           
                        </div>
                    </div>
                </form>
            </div>

            <!-- ========================= CREATE MODE ========================= -->
            <div th:if="${!isEdit}">

                <form th:action="@{/staff/restock/new}" method="get" class="mb-4">

                    <label class="form-label fw-bold text-primary">Step 1: Select Supplier</label>
                    <select class="form-select shadow-inner"
                            name="vendorId"
                            onchange="this.form.submit()"
                            required>
                        <option value="" disabled
                                th:selected="${selectedVendorId == null}">
                            -- Choose Vendor to see Products --
                        </option>

                        <option th:each="v : ${vendors}"
                                th:value="${v.vendorId ?: v.id}"
                                th:selected="${selectedVendorId == (v.vendorId ?: v.id)}"
                                th:text="${v.name}">
                        </option>
                    </select>
                </form>

                <form th:action="@{/staff/restock}" method="post"
                      th:object="${req}" class="row g-4">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="vendorId" th:value="${selectedVendorId}"/>

                    <div class="col-md-8">
                        <label class="form-label fw-bold">Step 2: Select Low-Stock Item</label>
                        <select class="form-select shadow-inner"
                                th:field="*{productId}"
                                th:disabled="${#lists.isEmpty(products)}"
                                required>
                            <option value="" disabled>-- Select Product --</option>
                            <option th:each="p : ${products}"
                                    th:value="${p.productId ?: p.id}"
                                    th:text="${p.brand + ' ' + p.name}">
                            </option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label fw-bold">Step 3: Quantity</label>
                        <input type="number" min="1" class="form-control shadow-inner"
                               th:field="*{requestedQty}" required />
                    </div>

                    <div class="col-12 d-flex justify-content-between align-items-center pt-3">
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary px-4 shadow-soft" type="submit"
                                    th:disabled="${selectedVendorId == null}">
                                <i class="bi bi-send-fill me-2"></i> Submit Request
                            </button>

                            <a th:href="@{/dashboard}" class="btn btn-outline-secondary">Cancel</a>
                        </div>

                        <span class="badge bg-secondary">
                            <i class="bi bi-clock-history me-1"></i> Status: PENDING
                        </span>
                    </div>

                </form>
            </div>

        </div>
    </div>

</div>

</body>
</html>
