<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head('Admin Categories')}">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap Icons (if not already included in fragments) -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    /* ============================================================
       THEME TOKENS
       ============================================================ */
    :root {
      --primary: #0066ff;
      --primary-light: #4d8dff;
      --primary-dark: #0044cc;

      --bg: #f4f7fc;
      --card: #ffffff;
      --glass: rgba(255,255,255,0.65);

      --text: #1c1f2b;
      --text-muted: #6b7280;

      --shadow-soft: 0 6px 18px rgba(0,0,0,0.06);
      --shadow-3d: 0 12px 30px rgba(0,0,0,0.10);
      --shadow-strong: 0 15px 35px rgba(0,0,0,0.15);

      --radius: 16px;
    }

    /* ============================================================
       PAGE BASE
       ============================================================ */
    body.main-wrapper {
      background: var(--bg);
      color: var(--text);
      padding-bottom: 40px;
      /* IMPORTANT: do NOT apply perspective globally (breaks click hit-testing) */
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: .5rem;
      font-weight: 700;
    }

    /* ============================================================
       CARDS (safe transforms, no 3D rotate)
       ============================================================ */
    .card {
      border-radius: var(--radius);
      border: none;
      background: var(--card);
      box-shadow: var(--shadow-soft);
      transition: .28s cubic-bezier(.2,.8,.2,1);
      transform-style: flat;
      position: relative;
      z-index: 1;
    }
    .card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-strong);
    }
    .card::before, .card::after { pointer-events: none; }

    /* ============================================================
       TABLE
       ============================================================ */
    .table {
      background: #fff;
      border-radius: calc(var(--radius) - 4px);
      overflow: clip; /* safer than hidden with transforms around */
      margin-bottom: 0;
    }
    .table thead {
      background: #eef3ff;
      color: var(--primary-dark);
      font-weight: 700;
      letter-spacing: .3px;
      font-size: 14px;
      border-bottom: 2px solid #d8e3ff;
    }
    .table-hover tbody tr:hover {
      background: #f4f8ff;
      cursor: pointer;
    }

    /* ============================================================
       FORMS
       ============================================================ */
    .form-control, .form-select {
      border-radius: 12px;
      padding: 10px 14px;
      border: 1px solid #dfe6f1;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.04);
      background: #fff;
      transition: .2s ease-in-out;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(0,102,255,.12);
      outline: 0;
    }
    .shadow-inner { box-shadow: inset 0 1px 3px rgba(0,0,0,.06) !important; }

    /* ============================================================
       PRIMARY BLUE BUTTON (matches theme + Vendor Add)
       ============================================================ */
    .btn-primary,
    .btn-outline-primary:hover,
    .btn-primary:focus,
    .btn-primary:active {
      color: #fff;
    }

    /* Base primary (Bootstrap override with neumorphic flavor) */
    .btn-primary {
      background: linear-gradient(145deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 14px;
      box-shadow:
        0 4px 10px rgba(0,102,255,.25),
        0 2px 4px rgba(0,0,0,.10);
      transition: .25s cubic-bezier(.4,0,.2,1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      transform: translateZ(0);
      will-change: transform, box-shadow, background;
    }
    .btn-primary:hover {
      background: linear-gradient(145deg, var(--primary-light), var(--primary));
      transform: translateY(-2px);
      box-shadow:
        0 8px 18px rgba(0,102,255,.35),
        0 4px 10px rgba(0,0,0,.12);
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow:
        0 2px 6px rgba(0,102,255,.25),
        0 1px 3px rgba(0,0,0,.10);
    }

    /* Icon color inside primary */
    .btn-primary i { color: #fff !important; }

    /* Make outline-primary harmonize with theme for secondary actions */
    .btn-outline-primary {
      color: var(--primary);
      border-color: #cfe0ff;
      background: #fff;
      border-radius: 12px;
    }
    .btn-outline-primary:hover {
      color: #fff;
      background: var(--primary);
      border-color: var(--primary);
      box-shadow: 0 6px 14px rgba(0,102,255,.25);
    }

    /* Danger outline stays red (for Delete) */
    .btn-outline-danger {
      border-radius: 12px;
    }

    /* Grid button column ensures button fills height of input row */
    @media (min-width: 768px) {
      .add-btn-col.d-grid { align-self: stretch; }
    }

    /* Feedback alerts shadow */
    .alert.shadow-sm { box-shadow: 0 4px 10px rgba(0,0,0,.04); }

    /* Border-left color for the add card: use primary to match blue theme */
    .border-start.border-4.border-primary { border-left-color: var(--primary) !important; }
  </style>
</head>

<body class="main-wrapper">
  <div th:replace="~{fragments :: nav}"></div>

  <div class="container py-4" style="max-width: 900px;">
    <h1 class="h3 section-title mb-4">
      <i class="bi bi-collection me-2"></i>Admin: Categories
    </h1>

    <!-- Feedback Alerts -->
    <div th:if="${msg}" class="alert alert-success shadow-sm" th:text="${msg}"></div>
    <div th:if="${err}" class="alert alert-danger shadow-sm" th:text="${err}"></div>

    <!-- ADD CATEGORY CARD -->
    <div class="card mb-4 border-0 shadow-sm border-start border-4 border-primary">
      <div class="card-body p-4">
        <form th:action="@{/admin/categories}" method="post" class="row g-3 align-items-end">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <div class="col-md-9">
            <label class="form-label fw-bold">New Category Name</label>
            <input class="form-control shadow-inner" name="name" placeholder="Enter category name" required />
          </div>
          <div class="col-md-3 d-grid add-btn-col">
            <!-- BLUE THEME PRIMARY BUTTON -->
            <button class="btn btn-primary" type="submit">
              <i class="bi bi-plus-lg"></i>
              Add Category
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- TABLE -->
    <div class="card shadow-sm border-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">ID</th>
              <th>Category Name</th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="c : ${categories}">
              <td class="small text-muted ps-4" th:text="${c?.categoryId}">ID</td>
              <td class="fw-semibold" th:text="${c?.name}">Name</td>
              <td class="text-end pe-4">
                <!-- EDIT -->
                <button type="button"
                        class="btn btn-sm btn-outline-primary me-2"
                        data-bs-toggle="modal"
                        data-bs-target="#editCategoryModal"
                        th:attr="data-id=${c.categoryId}, data-name=${c.name}">
                  <i class="bi bi-pencil me-1"></i>Edit
                </button>

                <!-- DELETE -->
                <form th:action="@{/admin/categories/delete/{id}(id=${c.categoryId})}" method="post" class="d-inline">
                  <input type="hidden" name="_method" value="delete" />
                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                  <button class="btn btn-sm btn-outline-danger" type="submit"
                          onclick="return confirm('Permanently remove this category?')">
                    <i class="bi bi-trash3 me-1"></i>Delete
                  </button>
                </form>
              </td>
            </tr>

            <!-- Empty -->
            <tr th:if="${#lists.isEmpty(categories)}">
              <td colspan="3" class="text-center py-4 text-muted">
                <i class="bi bi-inbox me-2"></i>No categories found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal fade" id="editCategoryModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form id="editCategoryForm" method="post" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Edit Category</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <div class="mb-3">
              <label class="form-label fw-bold">Category Name</label>
              <input id="ec-name" name="name" class="form-control" placeholder="Enter name" required />
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">
              <i class="bi bi-save me-1"></i>Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Modal wiring -->
  <script>
    const editCategoryModal = document.getElementById('editCategoryModal');
    editCategoryModal?.addEventListener('show.bs.modal', (event) => {
      const btn = event.relatedTarget;
      const id = btn.getAttribute('data-id');
      const name = btn.getAttribute('data-name') || '';
      const form = document.getElementById('editCategoryForm');
      const nameInput = document.getElementById('ec-name');
      form.action = `/admin/categories/${id}/edit`;
      nameInput.value = name;
    });
  </script>
</body>
</html>
